\hypertarget{index_autotoc_md5}{}\section{Introduction}\label{index_autotoc_md5}
A simple preprocessor preprocessor I generally use. It creates boilerplate functions based on tags.


\begin{DoxyItemize}
\item Author\+: Amos Buchanan
\item email\+: \href{mailto:amos@amosbuchanan.net}{\tt amos@amosbuchanan.\+net}
\item License\+: M\+IT, \href{https://opensource.org/licenses/MIT}{\tt https\+://opensource.\+org/licenses/\+M\+IT}
\end{DoxyItemize}\hypertarget{index_autotoc_md6}{}\section{Other Useful Libraries}\label{index_autotoc_md6}
Some links to other libraries I use and find useful.


\begin{DoxyItemize}
\item Sean T Barrett Single File Libraries\+: \href{https://github.com/nothings/stb}{\tt https\+://github.\+com/nothings/stb}
\item J\+S\+MN J\+S\+ON Parser\+: \href{https://github.com/zserge/jsmn}{\tt https\+://github.\+com/zserge/jsmn}
\end{DoxyItemize}\hypertarget{index_autotoc_md7}{}\section{General Usage}\label{index_autotoc_md7}
The preprocessor reads in the source files of a given directory and outputs a generated file with various useful functions. It\textquotesingle{}s mostly based on a \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{T\+A\+G()} pre-\/define with the various add-\/ons desired. See the preprocessor file for usage.

Example\+:


\begin{DoxyCode}
\hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Strings);
\textcolor{keyword}{enum class} \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours}
\{
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877aee38e4d5dd68c4e440825018d549cb47}{Red},
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877ad382816a3cbeed082c9e216e7392eed1}{Green},
    Blue
\};
\end{DoxyCode}


The trailing semicolon is optional.

Before compiling, run the preprocessor\+:


\begin{DoxyCode}
$ preprocessor src/ Generated
\end{DoxyCode}


This reads all the files in the {\ttfamily src/} directory, and creates a single file {\ttfamily src/\+Generated.\+h}. This file may be checked into source control, so even if you lose the preprocessor the existing functions aren\textquotesingle{}t lost.

In the above example, this will generate the functions related to \textquotesingle{}Strings\textquotesingle{}, which is a set of functions for converting enum values to and from strings. It will define functions such as {\ttfamily char $\ast$\+Enum\+To\+String(en\+Colours);}.

The generated file is a single-\/file-\/library. Anywhere in the source code, you can include the file as a header\+:


\begin{DoxyCode}
\textcolor{preprocessor}{#include "Generated.h"}
\end{DoxyCode}


In the place you want to pull in the code (once per project), add the appropriate define\+:


\begin{DoxyCode}
\textcolor{preprocessor}{#define GENERATED\_SRC}
\textcolor{preprocessor}{#include "Generated.h"}
\end{DoxyCode}
 The specific {\ttfamily \#define} to use is listed at the top of the generated file.

Do not modify generated files, they get over-\/written. You can safely re-\/run the preprocessor in the same directory as an existing generated files.

Several tags may be added by separating them with commas. Example\+:


\begin{DoxyCode}
\hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Strings, JSON, Label:Short);
\textcolor{keyword}{enum class} Length
\{   
    \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Short:\textcolor{stringliteral}{"m"})
    Meter,

    \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Short:\textcolor{stringliteral}{"in"})
    Inches

    \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Short:\textcolor{stringliteral}{"f"})
    Feet
\};
\end{DoxyCode}
\hypertarget{index_autotoc_md8}{}\section{Enum Class Tags}\label{index_autotoc_md8}
Tag always goes before the definition of {\ttfamily enum class}. Usage\+: 
\begin{DoxyCode}
\hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Tag1, Tag2:Option, ...)
enum class \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours}
\{
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877aee38e4d5dd68c4e440825018d549cb47}{Red},
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877ad382816a3cbeed082c9e216e7392eed1}{Green},
    Blue
\};
\end{DoxyCode}


If any enum tag is used, the following are defined\+: 
\begin{DoxyCode}
\textcolor{keyword}{enum class} \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours};
\textcolor{keyword}{const} u32 \hyperlink{Generated__Test_8h_abd85a89ac29df78a4d1b078c54016c79}{enColours\_Count};
\end{DoxyCode}
\hypertarget{index_autotoc_md9}{}\subsection{Strings}\label{index_autotoc_md9}
Usage\+: 
\begin{DoxyCode}
\hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Strings)
\textcolor{keyword}{enum class} \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours}
\{
    Unknown,
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877aee38e4d5dd68c4e440825018d549cb47}{Red},
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877ad382816a3cbeed082c9e216e7392eed1}{Green},
    Blue
\};
\end{DoxyCode}


This creates the following\+: 
\begin{DoxyCode}
\hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours} \hyperlink{Generated__Test_8h_ad369bcb4826dc155da6b130a0fa97d13}{StringToEnum<enColours>}(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *);
constexpr \textcolor{keywordtype}{char} \textcolor{keyword}{const} *\hyperlink{Generated__Test_8h_a37220bfe6977f9507cffa3283af7f09b}{EnumToCString}(\hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours});
\hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours} \hyperlink{Generated__Test_8h_ad369bcb4826dc155da6b130a0fa97d13}{StringToEnum<enColours>}(abs\_stringptr);
constexpr abs\_stringptr \hyperlink{Generated__Test_8h_a6087c1644a941337a7e8ac43157a30b3}{EnumToString}(\hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours});
\end{DoxyCode}


If you attempt to convert an invalid string to enum, the first enum value is returned. I usually reserve the first enum value as \textquotesingle{}Unknown\textquotesingle{} or \textquotesingle{}N\+OP\textquotesingle{}, which is how this convention came about.


\begin{DoxyCode}
\hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours} Colour = \hyperlink{Generated__Test_8h_ad369bcb4826dc155da6b130a0fa97d13}{StringToEnum<enColours>}(\textcolor{stringliteral}{"Monster"});
\textcolor{comment}{// Colour is enColours::Red}
\end{DoxyCode}
\hypertarget{index_autotoc_md10}{}\subsection{J\+S\+ON}\label{index_autotoc_md10}
Note\+: To use J\+S\+ON, you have to specify the define before the inclusion of the Generated header. Those only needs to be done once per project, even if you\textquotesingle{}re using multiple header files. This does add the dependency on the jsmn library, linked above. See below for general notes on using the J\+S\+ON tag. For example\+:


\begin{DoxyCode}
\textcolor{preprocessor}{#define GEN\_JSMN\_HEADER}
\textcolor{preprocessor}{#include "Generated.h"}
\end{DoxyCode}


Usage\+: 
\begin{DoxyCode}
\hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(JSON)
\textcolor{keyword}{enum class} \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours}
\{
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877aee38e4d5dd68c4e440825018d549cb47}{Red},
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877ad382816a3cbeed082c9e216e7392eed1}{Green},
    Blue
\};
\end{DoxyCode}


This creates the following\+: 
\begin{DoxyCode}
u32
\hyperlink{Generated__Test_8h_ad8caeb90f89cac9c8978390dc8ec420a}{PushJson}(\textcolor{keywordtype}{char} *Json, u32 MaxLength, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *Tag, \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours} Type, u32 JsonFlags);
\end{DoxyCode}
 This creates a json fragment of the form\+: 
\begin{DoxyCode}
"enColours": "Red"
\end{DoxyCode}


Takes a J\+S\+ON string {\ttfamily Json} of length {\ttfamily Json\+Length} and outputs {\ttfamily Object\+Out}. {\ttfamily Token\+Array} should be {\ttfamily N\+U\+LL}. 
\begin{DoxyCode}
jsmntok\_t *\hyperlink{Generated__Test_8h_a64411d75ccfa768d32520dac899352f3}{JsonToObject}(memory\_arena *VolatileMemory, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *Json, \textcolor{keywordtype}{size\_t} JsonLength, 
      jsmntok\_t *TokenArray, Colours *ObjectOut, u32 Unused);
\end{DoxyCode}
\hypertarget{index_autotoc_md11}{}\subsection{Label}\label{index_autotoc_md11}
This allows you to have arbitrary string labels for your enum items.

Usage\+: 
\begin{DoxyCode}
\hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Label:Object);
\textcolor{keyword}{enum class} \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours}
\{
    \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Object:\textcolor{stringliteral}{"Apple"})
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877aee38e4d5dd68c4e440825018d549cb47}{Red},

    \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Object:\textcolor{stringliteral}{"Brocoli"})
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877ad382816a3cbeed082c9e216e7392eed1}{Green},

    \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Object:\textcolor{stringliteral}{"Blueberry"})
    Blue
\};
\end{DoxyCode}


This creates the function\+: 
\begin{DoxyCode}
\textcolor{keyword}{const} \textcolor{keywordtype}{char} *\hyperlink{Generated__Test_8h_a9b8638e967a81b3c211b77df49d85034}{EnumToLabel\_Object}(\hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours} EnumToken);
\end{DoxyCode}


Note that you can have multiple labels on the same enum.


\begin{DoxyCode}
\hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Label:Object, Label:Animal);
\textcolor{keyword}{enum class} \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours}
\{
    \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Object:\textcolor{stringliteral}{"Apple"}, Animal:\textcolor{stringliteral}{"Panda"})
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877aee38e4d5dd68c4e440825018d549cb47}{Red},

    \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Object:\textcolor{stringliteral}{"Brocoli"}, Animal:\textcolor{stringliteral}{"Frog"})
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877ad382816a3cbeed082c9e216e7392eed1}{Green},

    \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Object:\textcolor{stringliteral}{"Blueberry"}, Animal:\textcolor{stringliteral}{"Cookie Monster"})
    Blue
\};
\end{DoxyCode}


Which creates\+: 
\begin{DoxyCode}
\textcolor{keyword}{const} \textcolor{keywordtype}{char} *\hyperlink{Generated__Test_8h_a9b8638e967a81b3c211b77df49d85034}{EnumToLabel\_Object}(\hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours} EnumToken);
\textcolor{keyword}{const} \textcolor{keywordtype}{char} *EnumToLabel\_Animal(\hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours} EnumToken);
\end{DoxyCode}


If you don\textquotesingle{}t have a label for a specific item, it just uses the item name itself\+:


\begin{DoxyCode}
\hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Label:Object);
\textcolor{keyword}{enum class} \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours}
\{
    Unknown, 

    \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Object:\textcolor{stringliteral}{"Apple"})
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877aee38e4d5dd68c4e440825018d549cb47}{Red},

    \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Object:\textcolor{stringliteral}{"Brocoli"})
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877ad382816a3cbeed082c9e216e7392eed1}{Green},

    \hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Object:\textcolor{stringliteral}{"Blueberry"})
    Blue
\};
\end{DoxyCode}


This creates the output\+: 
\begin{DoxyCode}
\textcolor{keyword}{const} \textcolor{keywordtype}{char}* Label = \hyperlink{Generated__Test_8h_a9b8638e967a81b3c211b77df49d85034}{EnumToLabel\_Object}(\hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours}:Unknown);
printf(\textcolor{stringliteral}{"%s\(\backslash\)n"}, Label); \textcolor{comment}{// prints 'Unknown'}
\end{DoxyCode}
\hypertarget{index_autotoc_md12}{}\section{Structs}\label{index_autotoc_md12}
\hypertarget{index_autotoc_md13}{}\subsection{J\+S\+ON}\label{index_autotoc_md13}
Creates functions for converting to/from J\+S\+ON, as per enum. Understands the base types as from {\ttfamily ab\+\_\+common.\+h}, and any structs/enums that are also tagged with {\ttfamily J\+S\+ON}. See below for more info on J\+S\+ON.

Usage\+: 
\begin{DoxyCode}
\hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(JSON)
\textcolor{keyword}{struct }\hyperlink{structmy__json__test}{my\_json\_test}
\{
    u8 \hyperlink{structmy__json__test_a0ea8af0c0061131955753275ad70dba4}{TestUnsigned};
    \textcolor{keywordtype}{char} \hyperlink{structmy__json__test_a497da009ff7ce7742cf99571b0752227}{TestString}[50];
    \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877}{enColours} \hyperlink{structmy__json__test_a6f1212d5aaf1f688e8887d5614d510ca}{MyColour};
    b8 \hyperlink{structmy__json__test_a55bffca96cce85232e33fc0c619a9eab}{isValue};
\};
\end{DoxyCode}


This generates the functions\+: Create a J\+S\+ON string and push it onto {\ttfamily Json}, which is a character buffer with the length {\ttfamily Max\+Length}. Uses the tag {\ttfamily Tag}. Returns number of characters written to {\ttfamily Json}, which is used to chain several structs together. 
\begin{DoxyCode}
u32 \hyperlink{Generated__Test_8h_ad8caeb90f89cac9c8978390dc8ec420a}{PushJson}(\textcolor{keywordtype}{char} *Json, u32 MaxLength, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *Tag, \textcolor{keyword}{const} 
      \hyperlink{structmy__json__test}{my\_json\_test} &Value, u32 JsonFlags);
\end{DoxyCode}


Example\+: 
\begin{DoxyCode}
\textcolor{keywordtype}{char} Buffer[100];
\hyperlink{structmy__json__test}{my\_json\_test} Value = \{10, \textcolor{stringliteral}{"SomeString"}, \hyperlink{PreprocTest_8h_a081cf1a0e70d6e2bd48c98f457742877aee38e4d5dd68c4e440825018d549cb47}{enColours::Red}, \textcolor{keyword}{true}\};
u32 \hyperlink{Generated__Test_8h_ad8caeb90f89cac9c8978390dc8ec420a}{PushJson}(Buffer, 100, \textcolor{stringliteral}{"MyStruct"}, Value, JSON\_IsLastInList);
\end{DoxyCode}


Generates\+: 
\begin{DoxyCode}
"MyStruct": \{"TestUnsigned": 10, "TestString": "SomeString", "MyColour": "Red", "isValue": true\}
\end{DoxyCode}


This struct is used to show what items exist in a J\+S\+ON string for a given struct, for use in {\ttfamily Json\+To\+Object}. 
\begin{DoxyCode}
\textcolor{keyword}{struct }\hyperlink{structmy__json__test__existlist}{my\_json\_test\_existlist}
\{
   b8 \hyperlink{structmy__json__test__existlist_abcc3320a088be44f3780f7768da67efa}{TestUnsigned};
   b8 \hyperlink{structmy__json__test__existlist_ad1bf35a0d6153e177322567228ae0203}{TestString};
   b8 \hyperlink{structmy__json__test__existlist_adc7bd401b4e560999733be88e43b5b7f}{MyColour};
   b8 \hyperlink{structmy__json__test__existlist_ad8b82af159a6dd0709800ca082156caf}{isValue};
\};
\end{DoxyCode}


Takes a J\+S\+ON string {\ttfamily Json} of length {\ttfamily Json\+Length} and outputs the base object {\ttfamily Object\+Out} and a list of whether the items existed in the original J\+S\+ON as {\ttfamily Items\+Exist\+Out}. {\ttfamily Token\+Array} should be {\ttfamily N\+U\+LL} when calling; this is used for the recursive functionality. 
\begin{DoxyCode}
jsmntok\_t *\hyperlink{Generated__Test_8h_a64411d75ccfa768d32520dac899352f3}{JsonToObject}(memory\_arena *VolatileMemory, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *Json, \textcolor{keywordtype}{size\_t} JsonLength, 
      jsmntok\_t *TokenArray, \hyperlink{structmy__json__test}{my\_json\_test} *ObjectOut, \hyperlink{structmy__json__test__existlist}{my\_json\_test\_existlist} *
      ItemsExistOut);
\end{DoxyCode}


Intake a J\+S\+ON string {\ttfamily Json} of length {\ttfamily Json\+Length} of an array of objects and output a pointers to the arrays {\ttfamily Object\+Array} and {\ttfamily Object\+Array\+Exist}. Returns the number of items in the array. 
\begin{DoxyCode}
u32
\hyperlink{Generated__Test_8h_a7f44ecb93f784751376b9bf5354d69f0}{JsonArrayToObjectArray}(memory\_arena *VolatileMemory, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *Json, \textcolor{keywordtype}{size\_t} 
      JsonLength, \hyperlink{structmy__json__test}{my\_json\_test} **ObjectArray, \hyperlink{structmy__json__test__existlist}{my\_json\_test\_existlist} **ObjectArrayExist
      );
\end{DoxyCode}
\hypertarget{index_autotoc_md14}{}\section{State Machine}\label{index_autotoc_md14}
I have a standard format for state machines I use, so I created a tag specifically for creating state machines.

Due to a limitation of the program, the statemachine tag {\itshape must} be in the same file as all the state machine functions. I haven\textquotesingle{}t found this to be particularly limiting,

Usage\+: 
\begin{DoxyCode}
\hyperlink{PreprocTest_8cpp_a47061d27749d7e9de66e4e834ab28848}{STATEMACHINE}(base\_name, struct\_name, cmd\_enum\_name \textcolor{comment}{/*, <other types for functions*/});
\end{DoxyCode}


This creates the following\+: 
\begin{DoxyCode}
\textcolor{keyword}{struct }cmd\_enum\_name\_queue
\{
    cmd\_enum\_name Items[10];
    s32 Front;
    s32 Rear;
\};

\textcolor{keyword}{inline} \textcolor{keywordtype}{void} \hyperlink{Generated__Test_8h_a43822849924e4365ec1ad146736a7967}{InitializeQueue}(cmd\_enum\_name\_queue *Queue);
\textcolor{keyword}{inline} b8 \hyperlink{Generated__Test_8h_a24b3c990497a61d0d6aca57105e2c86a}{isQueueEmpty}(cmd\_enum\_name\_queue *Queue);
\textcolor{keyword}{inline} b8 \hyperlink{Generated__Test_8h_a5074b01af8cb1f2124b7d04399a48c82}{isQueueFull}(cmd\_enum\_name\_queue *Queue);
b8 \hyperlink{Generated__Test_8h_a9ca011b44b1d493d71b8414f84af2f69}{EnqueueCommand}(cmd\_enum\_name\_queue *Queue, cmd\_enum\_name Cmd);
cmd\_enum\_name \hyperlink{Generated__Test_8h_aa15eaba01fecffd4380ff2f1b4018a3a}{DequeueCommand}(cmd\_enum\_name\_queue *Queue);

\textcolor{preprocessor}{#define BASE\_NAME(name) void name(struct\_name *State, cmd\_enum\_name Cmd }\textcolor{comment}{/*<, Other types for functions>*/}\textcolor{preprocessor}{)}
\textcolor{keyword}{typedef} BASE\_NAME(test\_statemachine);

\textcolor{keyword}{inline} b8 \hyperlink{Generated__Test_8h_ad4b73e92f4af2b501841ce35b274f71c}{GoToState}(struct\_name *State, base\_name  *NewState);
\textcolor{keywordtype}{char} \textcolor{keyword}{const} *\hyperlink{Generated__Test_8h_a36c15d4c27a71b37003bfc22b75964be}{GetStateName}(base\_name *StateName);
b8 \hyperlink{Generated__Test_8h_a9ca011b44b1d493d71b8414f84af2f69}{EnqueueCommand}(struct\_name *State, cmd\_enum\_name Cmd);
cmd\_enum\_name \hyperlink{Generated__Test_8h_aa15eaba01fecffd4380ff2f1b4018a3a}{DequeueCommand}(struct\_name *State);

\textcolor{comment}{//<Declaration of State Machine Functions>}
\end{DoxyCode}


You can then create state machine functions using {\ttfamily B\+A\+S\+E\+\_\+\+N\+A\+ME} (The declaration is always capitolized, the function typedef is always lowercase.)\+: 
\begin{DoxyCode}
BASE\_NAME(IdleState)
\{\}

BASE\_NAME(RunningState)
\{\}
\end{DoxyCode}


N\+O\+TE\+: The command queue must be initialized before it can be used. 
\begin{DoxyCode}
\hyperlink{Generated__Test_8h_a43822849924e4365ec1ad146736a7967}{InitializeQueue}(State->\hyperlink{structtest__type_a9ef32b05c6f8a712062f8261d71665ca}{CommandQueue});
\end{DoxyCode}


The proper state struct and command enum must be created; the generator doesn\textquotesingle{}t do that for you. The first element of the command queue should be a no operation ({\ttfamily N\+OP}), as an empty queue will return the first item when attempting to dequeue.

Example\+: 
\begin{DoxyCode}
\textcolor{comment}{// statemachine.h}
\textcolor{keyword}{struct }\hyperlink{structtest__type}{test\_type}
\{
    \textcolor{comment}{// These three variables *must* be defined.}
    test\_statemachine *\hyperlink{structtest__type_a48139457e16e23a57531e5af02be7f14}{CurrentState};
    b8 \hyperlink{structtest__type_a36eb3041ef1341aec27a2a2d98500ce6}{isNewState};
    \hyperlink{structtest__cmd__queue}{test\_cmd\_queue} \hyperlink{structtest__type_a9ef32b05c6f8a712062f8261d71665ca}{CommandQueue};
\};

\hyperlink{PreprocTest_8h_a2606cd56d2d8f567785bde5848176722}{TAG}(Strings)
\textcolor{keyword}{enum class} \hyperlink{PreprocTest_8h_a55ed691059222a58555cf9992ec14431}{test\_cmd}
\{
    \hyperlink{PreprocTest_8h_a55ed691059222a58555cf9992ec14431a1a004f5abe2b334db21328be1ea6b593}{NOP},
    \hyperlink{PreprocTest_8h_a55ed691059222a58555cf9992ec14431a1ed25d14e3a228b0089b334bdbca5769}{Command1},
    \hyperlink{PreprocTest_8h_a55ed691059222a58555cf9992ec14431a0c33f49f722805e5a6f6f759b491fa2a}{Command2},
    \hyperlink{PreprocTest_8h_a55ed691059222a58555cf9992ec14431a732a6c81e81f68d48d63e795bd06ab22}{Command3},
    \hyperlink{PreprocTest_8h_a55ed691059222a58555cf9992ec14431aeb4001380fa7b2b0c963a882c2305280}{Command4},
    Last
\};

\textcolor{comment}{// statemachine.c}
\textcolor{preprocessor}{#include "statemachine.h"}

\hyperlink{PreprocTest_8cpp_a47061d27749d7e9de66e4e834ab28848}{STATEMACHINE}(test\_statemachine, \hyperlink{structtest__type}{test\_type}, \hyperlink{PreprocTest_8h_a55ed691059222a58555cf9992ec14431}{test\_cmd}, \textcolor{keywordtype}{int} SomeInt, \textcolor{keywordtype}{char} \textcolor{keyword}{const} *
      AString);

\hyperlink{Generated__Test_8h_a60e76ed427c4968689b9571af7254547}{TEST\_STATEMACHINE}(StartupState)
\{
    \hyperlink{Generated__Test_8h_a43822849924e4365ec1ad146736a7967}{InitializeQueue}(State->\hyperlink{structtest__type_a9ef32b05c6f8a712062f8261d71665ca}{CommandQueue});
    \textcolor{comment}{// Code Here}
    \hyperlink{Generated__Test_8h_ad4b73e92f4af2b501841ce35b274f71c}{GoToState}(State, IdleState);
\}

\hyperlink{Generated__Test_8h_a60e76ed427c4968689b9571af7254547}{TEST\_STATEMACHINE}(IdleState)
\{
    \textcolor{comment}{// Code Here}
    \hyperlink{Generated__Test_8h_ad4b73e92f4af2b501841ce35b274f71c}{GoToState}(State, RunningState);
\}


\hyperlink{Generated__Test_8h_a60e76ed427c4968689b9571af7254547}{TEST\_STATEMACHINE}(RunningState)
\{
    \hyperlink{PreprocTest_8h_a55ed691059222a58555cf9992ec14431}{test\_cmd} = \hyperlink{Generated__Test_8h_aa15eaba01fecffd4380ff2f1b4018a3a}{DequeueCommand}(State);
    \textcolor{comment}{// Code Here}
    printf(\textcolor{stringliteral}{"Input Int: %d\(\backslash\)n"}, SomeInt); 
    printf(\textcolor{stringliteral}{"Input String: %s\(\backslash\)n"}, AString);
    QueueCommand(State, \hyperlink{PreprocTest_8h_a55ed691059222a58555cf9992ec14431a1ed25d14e3a228b0089b334bdbca5769}{test\_cmd::Command1});

    \textcolor{keywordtype}{char} *StateName = \hyperlink{Generated__Test_8h_a36c15d4c27a71b37003bfc22b75964be}{GetStateName}(State->\hyperlink{structtest__type_a48139457e16e23a57531e5af02be7f14}{CurrentState});
    printf(\textcolor{stringliteral}{"Current State: %s\(\backslash\)n"}, StateName); \textcolor{comment}{// Prints "Current State: RunningState"}

    \hyperlink{Generated__Test_8h_ad4b73e92f4af2b501841ce35b274f71c}{GoToState}(State, IdleState);
\}
\end{DoxyCode}
\hypertarget{index_autotoc_md15}{}\section{J\+S\+ON}\label{index_autotoc_md15}
Structs and enums can both be tagged with {\ttfamily J\+S\+ON}. This creates som functions for creating and reading J\+S\+ON objects into C structs or enums. They all follow a similar format, and are recursive. So if you have a struct tagged J\+S\+ON, all the enums and structs it refers to must also be tagged J\+S\+ON.

The preprocessor uses the functions in {\ttfamily ab\+\_\+json.\+h} as general functions to use. This means you must include the define 
\begin{DoxyCode}
\textcolor{preprocessor}{#define AB\_JSON\_SRC}
\end{DoxyCode}
 somewhere in your code so the source can be picked up. It should only be defined once, and could probably be defined in the compiler (though I haven\textquotesingle{}t tested this).

You will also have to include the source to the J\+S\+MN parser somewhere. If you are using the version I\textquotesingle{}ve included here, you only need to define the following\+:


\begin{DoxyCode}
\textcolor{preprocessor}{#define JSMN\_SRC}
\textcolor{preprocessor}{#include "jsmn.h"}
\end{DoxyCode}


I\textquotesingle{}ve slightly modified the source so this works everywhere. If you are using it directly from git, you\textquotesingle{}ll have read up on how to properly include the source.\hypertarget{index_autotoc_md16}{}\section{M\+I\+T License}\label{index_autotoc_md16}
\href{https://opensource.org/licenses/MIT}{\tt https\+://opensource.\+org/licenses/\+M\+IT}

Copyright 2020 Amos Buchanan

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \char`\"{}\+Software\char`\"{}), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions\+:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

T\+HE S\+O\+F\+T\+W\+A\+RE IS P\+R\+O\+V\+I\+D\+ED \char`\"{}\+A\+S I\+S\char`\"{}, W\+I\+T\+H\+O\+UT W\+A\+R\+R\+A\+N\+TY OF A\+NY K\+I\+ND, E\+X\+P\+R\+E\+SS OR I\+M\+P\+L\+I\+ED, I\+N\+C\+L\+U\+D\+I\+NG B\+UT N\+OT L\+I\+M\+I\+T\+ED TO T\+HE W\+A\+R\+R\+A\+N\+T\+I\+ES OF M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY, F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE A\+ND N\+O\+N\+I\+N\+F\+R\+I\+N\+G\+E\+M\+E\+NT. IN NO E\+V\+E\+NT S\+H\+A\+LL T\+HE A\+U\+T\+H\+O\+RS OR C\+O\+P\+Y\+R\+I\+G\+HT H\+O\+L\+D\+E\+RS BE L\+I\+A\+B\+LE F\+OR A\+NY C\+L\+A\+IM, D\+A\+M\+A\+G\+ES OR O\+T\+H\+ER L\+I\+A\+B\+I\+L\+I\+TY, W\+H\+E\+T\+H\+ER IN AN A\+C\+T\+I\+ON OF C\+O\+N\+T\+R\+A\+CT, T\+O\+RT OR O\+T\+H\+E\+R\+W\+I\+SE, A\+R\+I\+S\+I\+NG F\+R\+OM, O\+UT OF OR IN C\+O\+N\+N\+E\+C\+T\+I\+ON W\+I\+TH T\+HE S\+O\+F\+T\+W\+A\+RE OR T\+HE U\+SE OR O\+T\+H\+ER D\+E\+A\+L\+I\+N\+GS IN T\+HE S\+O\+F\+T\+W\+A\+RE. 